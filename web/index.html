<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Tomcat WebSocket Chat</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="bootstrap.min.css">

  <style type="text/css">
    #container {
      width: 100%;
      margin: auto;
    }
    .padd {
      padding-top: 15px;
    }
    #messages-list {
      max-height: 95vh;
      overflow: auto;
    }
  </style>
  <script>
      var ws = new WebSocket("ws://localhost:8080/ws");
      ws.onopen = function(){
      };
      ws.onmessage = function(mess) {
          var data = JSON.parse(mess.data);
          var messageList = document.getElementById('messages-list');
          var message = document.createElement('div');
          message.setAttribute('class','list-group-item');
          var author = document.createElement('div');
          author.setAttribute('class', 'author');
          author.setAttribute('style','font-weight: bold; color: red');
          author.innerHTML = isEmptyField(data['login'])?'Guest':data['login'];
          var content = document.createElement('div');
          content.setAttribute('class', 'content');
          content.innerHTML = data['message'];
          message.appendChild(author);
          message.appendChild(content);
          messageList.appendChild(message);
      };
      ws.onclose = function (p1) {  };
      function isEmptyField(str) {
          if(str===undefined){
              return true;
          }
          return str.trim() === '';
      }
      function postToServer(){
          var mess = document.getElementById("message").value;
          if (!isEmptyField(mess)) {
              var jsonObj = {
                  login: document.getElementById("login").value,
                  message: document.getElementById("message").value
              };
              ws.send(JSON.stringify(jsonObj));
              document.getElementById("message").value = '';
          }
      }

  </script>
</head>
<body>
<div id="container" class="row">
  <div class="col-md-4 col-sm-12 col-xs-12" >
      <div class="row">
        <div id="textarea" class="text col-xs-12 col-sm-8 col-md-12 padd">
          <textarea name="text" class="form-control" rows="8" id="message" ></textarea>
        </div>
        <div id="login-form" class="login col-xs-12 col-sm-4 col-md-12 padd">
          <div class="form-group">
            <label for="login">Login: </label>
            <input name="login" type="text" class="form-control" id="login" >
          </div>
          <button class="btn btn-primary btn-block" type="submit" id="sendButton" onClick="postToServer()">Send!</button>
        </div>
      </div>
  </div>

  <div class="col-md-8 col-sm-12 col-xs-12 padd">
    <div id="messages-list" class="list-group">
      <script>
          getRecords();
      </script>
    </div>
  </div>
</div>

</body>
</html>